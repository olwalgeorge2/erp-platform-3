# Quarkus dev profile overrides for local testing

# Quarkus dev profile overrides for local testing

quarkus:
  smallrye-jwt:
    # Default off to avoid startup errors if public key is not present.
    # Enable by setting env var JWT_ENABLED=true or -DJWT_ENABLED=true
    enabled: ${JWT_ENABLED:false}

mp:
  jwt:
    verify:
      publickey:
        # Use local dev RSA key (generated by scripts/dev-jwt.*)
        # Prefer classpath to avoid relative path issues in dev
        # Override with env var JWT_PUBLIC_KEY_LOCATION if needed
        location: ${JWT_PUBLIC_KEY_LOCATION:classpath:keys/dev-jwt-public.pem}
      issuer: ${JWT_ISSUER:erp-platform-dev}
      audiences: ${JWT_AUDIENCES:}

gateway:
  # Dev-only: make health and test endpoints public to bypass auth
  public-prefixes:
    - "/q/"
    - "/test/"
  auth:
    # Toggle protected prefixes easily during local dev
    protected-prefixes:
      - "/api/v1/secure/"
      - "/api/admin/"

# Allow unknown mapping properties in dev (so gateway.auth.* is tolerated
# even if not part of strict @ConfigMapping roots)
smallrye:
  config:
    mapping:
      validate-unknown: false
  jwt:
    time:
      allowed-clock-skew: ${JWT_ALLOWED_CLOCK_SKEW:30}
