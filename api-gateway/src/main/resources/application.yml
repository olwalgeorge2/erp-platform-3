quarkus:
  http:
    port: ${API_GATEWAY_PORT:8080}
    host: ${API_GATEWAY_HOST:0.0.0.0}
    cors:
      origins: ${CORS_ORIGINS:http://localhost:3000}
      methods: GET,POST,PUT,DELETE,PATCH,OPTIONS
      headers: Authorization,Content-Type,X-Trace-Id,X-Tenant-Id,X-User-Id
      exposed-headers: Location,X-Total-Count,X-RateLimit-Limit,X-RateLimit-Remaining
      access-control-max-age: 3600

  redis:
    hosts: ${REDIS_URL:redis://localhost:6379}
    password: ${REDIS_PASSWORD:}
    timeout: 10s

  log:
    console:
      json: ${QUARKUS_LOG_CONSOLE_JSON:true}
    level: ${QUARKUS_LOG_LEVEL:INFO}

mp:
  jwt:
    verify:
      publickey:
        location: ${JWT_PUBLIC_KEY_URL:http://localhost:8081/api/v1/identity/.well-known/jwks.json}
      issuer: ${JWT_ISSUER:erp-platform}
      # Accept only these audiences (comma-separated). Leave empty to skip audience check.
      audiences: ${JWT_AUDIENCES:}

smallrye:
  jwt:
    time:
      # Allowed clock skew in seconds when validating iat/exp/nbf
      allowed-clock-skew: ${JWT_ALLOWED_CLOCK_SKEW:30}

gateway:
  routes:
    - pattern: "/api/v1/identity/*"
      base-url: ${IDENTITY_SERVICE_URL:http://localhost:8081}
      timeout: 5s
      retries: 2
      auth-required: false
      health-path: "/q/health"
      backoff-initial-ms: 100
      backoff-max-ms: 1000
      backoff-jitter-ms: 50
      rewrite:
        remove-prefix: "/api/v1/identity"
        add-prefix: "/api"

  public-prefixes:
    - "/api/v1/health"
    - "/api/v1/metrics"
    - "/q/health"

  rate-limits:
    default:
      requests-per-minute: ${RATE_LIMIT_DEFAULT_REQUESTS:100}
      window: ${RATE_LIMIT_DEFAULT_WINDOW:60s}

  auth:
    protected-prefixes:
      - "/api/v1/identity"
      - "/api/v1/tenancy"
  
  # Timing guard configuration (flat property for @ConfigProperty)
  timing-guard:
    min-failure-duration-ms: 100
