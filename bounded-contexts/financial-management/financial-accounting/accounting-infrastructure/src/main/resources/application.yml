# Financial Accounting Service configuration
quarkus:
  application:
    name: financial-accounting-service
  index-dependency:
    financial-shared:
      group-id: com.example.erp
      artifact-id: financial-shared

  http:
    port: ${FINANCE_HTTP_PORT:8082}
    host: ${FINANCE_HTTP_HOST:0.0.0.0}
    # Security: DOS prevention via request size limits
    limits:
      max-body-size: 10M
      max-header-size: 8K

  datasource:
    db-kind: postgresql

  flyway:
    migrate-at-start: true
    default-schema: financial_accounting
    locations: classpath:db/migration
    validate-on-migrate: true
    baseline-on-migrate: true
    clean-disabled: true

  hibernate-orm:
    database:
      default-schema: financial_accounting
      generation: none
    log:
      sql: ${QUARKUS_HIBERNATE_LOG_SQL:false}
      format-sql: true
      bind-parameters: true

  kafka:
    bootstrap-servers: ${KAFKA_BOOTSTRAP_SERVERS:localhost:9092}

  log:
    console:
      json: ${QUARKUS_LOG_CONSOLE_JSON:true}

  micrometer:
    export:
      prometheus:
        enabled: true
        path: /q/metrics

  health:
    extensions:
      enabled: true

  smallrye-openapi:
    path: /q/openapi
    additional-docs: META-INF/openapi/error-responses.yaml
  swagger-ui:
    path: /q/swagger-ui
    always-include: true

finance:
  outbox:
    retention-days: ${FINANCE_OUTBOX_RETENTION_DAYS:7}

"%prod":
  quarkus:
    datasource:
      username: ${FINANCE_DB_USERNAME:postgres}
      password: ${FINANCE_DB_PASSWORD:postgres}
      jdbc:
        url: ${FINANCE_DB_JDBC_URL:jdbc:postgresql://127.0.0.1:5432/test}
        min-size: 2
        max-size: 8
        initial-size: 2
        acquisition-timeout: 30s

mp:
  openapi:
    filter: com.erp.financial.shared.openapi.FinanceErrorResponsesFilter
  messaging:
    outgoing:
      finance-journal-events-out:
        connector: smallrye-kafka
        topic: ${FINANCE_JOURNAL_TOPIC:finance.journal.events.v1}
        key-serializer: org.apache.kafka.common.serialization.StringSerializer
        value-serializer: org.apache.kafka.common.serialization.StringSerializer
        acks: all
        retries: 3
        enable-idempotence: true
        max-in-flight-requests-per-connection: 5
        compression-type: snappy
        client-id: finance-journal-${quarkus.uuid}
      finance-period-events-out:
        connector: smallrye-kafka
        topic: ${FINANCE_PERIOD_TOPIC:finance.period.events.v1}
        key-serializer: org.apache.kafka.common.serialization.StringSerializer
        value-serializer: org.apache.kafka.common.serialization.StringSerializer
        acks: all
        retries: 3
        enable-idempotence: true
        max-in-flight-requests-per-connection: 5
        compression-type: snappy
        client-id: finance-period-${quarkus.uuid}
      finance-dimension-events-out:
        connector: smallrye-kafka
        topic: ${FINANCE_DIMENSION_TOPIC:finance.dimensions.events.v1}
        key-serializer: org.apache.kafka.common.serialization.StringSerializer
        value-serializer: org.apache.kafka.common.serialization.StringSerializer
        acks: all
        retries: 3
        enable-idempotence: true
        max-in-flight-requests-per-connection: 5
        compression-type: snappy
        client-id: finance-dimension-${quarkus.uuid}

# Custom finance knobs (used by future services/tests)
financial-accounting:
  performance:
    journal-posting-timeout: 5s
    ledger-query-timeout: 2s
    period-close-timeout: 30s
  business-rules:
    max-journal-lines-per-entry: 1000
    default-currency: USD
    require-balanced-entries: true
    enable-period-validation: true

validation:
  metrics:
    context: finance-accounting
  performance:
    cache:
      ledger:
        max-size: 5000
        ttl: PT10M
      chart:
        max-size: 2000
        ttl: PT10M
      warmup:
        enabled: true
        ledgers: 50
        charts: 25
  security:
    rate-limit:
      enabled: true
      default:
        limit: 100
        window-seconds: 60
      sox:
        limit: 20
        window-seconds: 60
      user:
        limit: 500
        window-seconds: 60
      sox-path-prefixes: /api/v1/finance/journal-entries,/api/v1/finance/ap/invoices,/api/v1/finance/ar/invoices
    abuse:
      threshold: 25
      window-seconds: 60
