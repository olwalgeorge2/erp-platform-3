@host = http://localhost:8081
@tenantName = Quarkus Test Tenant
@tenantSlug = tenant-{{$randomInt 100000 999999}}

# Will be set by the Provision Tenant response handler below.
@tenantId = 00000000-0000-0000-0000-000000000000

# Will be set by the Create Role response handler below.
@roleId = 00000000-0000-0000-0000-000000000000

# Canonical path: /api/v1/identity/**. Legacy /api/** alias remains temporarily for dev clients.

# Simulated gateway-provided principal headers
@userId = rest-client-admin
@userRoles = TENANT_ADMIN
@userPermissions = roles:manage,roles:read

### Provision Tenant
POST {{host}}/api/v1/identity/tenants
Content-Type: application/json

{
  "name": "{{tenantName}}",
  "slug": "{{tenantSlug}}",
  "subscription": {
    "plan": "STARTER",
    "startDate": "{{$datetime rfc3339}}",
    "maxUsers": 25,
    "maxStorage": 5000,
    "features": [
      "rbac"
    ]
  },
  "metadata": {
    "env": "dev"
  }
}

> {%
  if (response.status === 201 && response.body && response.body.id) {
    client.global.set("tenantId", response.body.id);
  }
%}

###

### Activate Tenant
POST {{host}}/api/v1/identity/tenants/{{tenantId}}/activate
Content-Type: application/json

{
  "requestedBy": "rest-client"
}

###

@roleName = tenant-admin

### Create Role
POST {{host}}/api/v1/identity/tenants/{{tenantId}}/roles
Content-Type: application/json
X-User-Id: {{userId}}
X-User-Roles: {{userRoles}}
X-User-Permissions: {{userPermissions}}
X-Tenant-ID: {{tenantId}}

{
  "name": "{{roleName}}",
  "description": "Tenant administrator role",
  "permissions": [
    { "resource": "users", "action": "manage", "scope": "TENANT" },
    { "resource": "tenants", "action": "read", "scope": "TENANT" }
  ],
  "metadata": {
    "createdBy": "rest-client"
  }
}

> {%
  if (response.status === 201 && response.body && response.body.id) {
    client.global.set("roleId", response.body.id);
  }
%}

###

### List Roles
GET {{host}}/api/v1/identity/tenants/{{tenantId}}/roles
X-User-Id: {{userId}}
X-User-Roles: {{userRoles}}
X-User-Permissions: roles:read
X-Tenant-ID: {{tenantId}}

###

### Update Role
PUT {{host}}/api/v1/identity/tenants/{{tenantId}}/roles/{{roleId}}
Content-Type: application/json
X-User-Id: {{userId}}
X-User-Roles: {{userRoles}}
X-User-Permissions: {{userPermissions}}
X-Tenant-ID: {{tenantId}}

{
  "name": "{{roleName}}",
  "description": "Updated tenant administrator role",
  "permissions": [
    { "resource": "users", "action": "manage", "scope": "TENANT" },
    { "resource": "tenants", "action": "read", "scope": "TENANT" },
    { "resource": "roles", "action": "manage", "scope": "TENANT" }
  ],
  "metadata": {
    "updatedBy": "rest-client"
  }
}

###

### Get Role
GET {{host}}/api/v1/identity/tenants/{{tenantId}}/roles/{{roleId}}
X-User-Id: {{userId}}
X-User-Roles: {{userRoles}}
X-User-Permissions: roles:read
X-Tenant-ID: {{tenantId}}

###

### Delete Role
DELETE {{host}}/api/v1/identity/tenants/{{tenantId}}/roles/{{roleId}}
X-User-Id: {{userId}}
X-User-Roles: {{userRoles}}
X-User-Permissions: {{userPermissions}}
X-Tenant-ID: {{tenantId}}

###

### List Roles After Deletion
GET {{host}}/api/v1/identity/tenants/{{tenantId}}/roles
X-User-Id: {{userId}}
X-User-Roles: {{userRoles}}
X-User-Permissions: roles:read
X-Tenant-ID: {{tenantId}}

###

### Fetch Built-in Role Templates
GET {{host}}/api/v1/identity/roles/templates
